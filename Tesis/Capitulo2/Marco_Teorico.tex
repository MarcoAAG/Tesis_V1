\chapter{Marco Téorico}
En este capitulo desarrolla la teoría que fundamenta el proyecto de investigación con base
en el problema previamente descrito.\\
Antes de entrar a la teoría es necesario entender cuales son las fases del proyecto y
el porque de ellas.
La siguiente imagen muestra la similitud entre el sistema de adquisición de datos
de un humano y la de un sistema digital.
\begin{center}
    \includegraphics[width=0.65\textwidth]{Capitulo2/Fig1.eps}       
    \captionof{figure}{Similitudes entre humano y computadora}\label{Fig1}
\end{center}
Donde se observa un diagrama de flujo que empieza con la adquisición de datos, en este
caso la captura de una imagen, posterior se hace un procesamiento, es decir, se le da
sentido a los datos, y finalmente se hace una acción con base en la tarea que el procesador
ha generado.

\section{Óptica}
La visión artificial surge de un amplio estudio probabilístico y matemático del 
procesamiento de imágenes digitales, pero sobre todo de análisis humanos y de la 
intuición ya que de estas últimas el ingeniero hace selección de entre una u otra 
técnica. Esta elección se basa usualmente en juicios visuales subjetivos.\\
Entender los conceptos básicos de la percepción humana es entonces pertinente, donde 
la Óptica nos ayudará a entender mejor como es que el ojo humano percibe y como lo 
hace una cámara. \\
La función de la óptica de una cámara es captar los rayos luminosos y concentrarlos 
sobre el sensor sensible de la cámara de vídeo. Después de determinar el tipo de 
iluminación que mejor se adecua al problema, la elección de una óptica u otra influirá 
en la calidad de la imagen y el tamaño de los objetos.
\subsection{Descripción general del sistema visual humano}
La luz entra al ojo y estimula los sensores en la parte posterior. 
La señal que se crea luego viaja a través del nervio óptico, cruzando el 
nervio que proviene del otro ojo y llega a un órgano, en el interior del 
cerebro en el área del tálamo, llamado núcleo geniculado lateral (LGN). 
Las salidas de la LGN se envían a la corteza visual en la parte posterior del cerebro. 
La corteza visual es quizás la parte más compleja del cuerpo humano. Es el lugar en el 
cerebro donde tiene lugar la mayor parte del procesamiento visual.~\cite{anilbharath2008}
\begin{center}
    \includegraphics[width=0.55\textwidth]{Capitulo2/Fig1_1.eps}       
    \captionof{figure}{El camino que sigue la señal óptica dentro de la cabeza humana.}\label{Fig1_1}
\end{center}
En términos generales, cuanto más nos alejamos del camino visual del ojo, menos 
entendemos lo que está sucediendo.
\subsection{Estructura del ojo humano}
Es necesario abordar algunos conceptos basicos para entendernos en un 
futuro, pero sobre todo comprender las similitudes del ojo humano y 
la cámara, además de analizar limitaciones físicas de la vista humana 
en los mismos términos que usaremos para nuestras imágenes digitales.
\begin{itemize}
\item Cornea: La córnea es una estructura del ojo que permite el paso de la luz 
desde el exterior al interior del ojo y protege el iris y el cristalino. Posee 
propiedades ópticas de refracción y para garantizar su función debe ser transparente 
y es necesario que mantenga una curvatura adecuada.
\item Esclerótica: Es el recubrimiento exterior blanco del ojo. La esclerótica le da 
su color blanco al globo ocular.
\item Coroides: Es la capa de vasos sanguíneos y tejido conectivo entre la parte blanca del ojo y la retina (en la parte posterior del ojo). Es parte de la úvea y suministra los nutrientes a las partes internas del ojo.
\item Cuerpo ciliar: Es una estructura circular que es una prolongación del iris, la 
parte de color del ojo. También contiene el músculo ciliar, el cual cambia la forma 
del cristalino cuando los ojos se enfocan en un objeto cercano. Este proceso se 
denomina acomodación.
\item Diafragma Iris: que se expande o contrae para controlar la cantidad de luz que 
entra en el ojo. La apertura central del iris, llamada pupila, varía su diámetro de 2 
a 8mm. El frente del iris contiene el pigmento visible del ojo, y la parte trasera 
contiene un pigmento negro.
\item Cristalino: El cristalino es “la lente” del ojo y sirve para enfocar, ayudado 
por los músculos ciliares. El cristalino es una lente que actúa como una lente 
biconvexa, lenticular, flexible y avascular, cuya principal función es la de enfocar 
los objetos en las distintas distancias correctamente.
\item Retina: Es la capa de tejido sensible a la luz que se encuentra en la parte 
posterior globo ocular. Las imágenes que pasan a través del cristalino del ojo se 
enfocan en la retina. La retina convierte entonces estas imágenes en señales eléctricas
y las envía por el nervio óptico al cerebro.
\end{itemize}
~\cite{joseramon2005}
\begin{center}
    \includegraphics[width=0.55\textwidth]{Capitulo2/Fig1_2.eps}       
    \captionof{figure}{Componentes generales del ojo humano}\label{Fig1_2}
\end{center}

\subsection{Formación de imágenes en el ojo}
En una cámara fotográfica se recibe la luz que traspasa el diafragma, pasa por los 
cristales de la cámara hasta llegar al CCD(Charge Coupled Device o, en español, 
Dispositivo de Carga Acoplada) o sensor, que es donde se forma la imagen correcta y se 
envía al procesador.\\
Algo similar pasa en el ojo, la pupila es el diagrama natural que filtra la luz que 
entra en el ojo, pasa por la lente (el cristalino)  que converge los rayos hasta 
llegar a la retina, que es la estructura que tiene las células fotosensibles y dónde 
se produce la imagen, y a través del nervio óptico se transporta la información al 
cuerpo geniculado, que es la parte del cerebro donde se produce la visión.\\
El ojo esta formado de dos componentes principales:
\begin{itemize}
\item Componentes ópticos: permiten la formación de la imagen en la retina y son los 
siguientes: la córnea, el cristalino, la pupila, el humor acuoso y el humor vítreo que 
permiten la formación de una imagen en la retina.
\item Componentes neurológicos: son los que transforman la información óptica en 
eléctrica y transmiten la información al cuerpo geniculado lateral. Estos componentes 
son la retina y el nervio óptico.
\end{itemize}
\begin{center}
    \includegraphics[width=0.65\textwidth]{Capitulo2/Fig1_3.eps}       
    \captionof{figure}{Formación de una imagen en el ojo}\label{Fig1_3}
\end{center}
La principal diferencia entre una lente óptica ordinaria y el cristalino es 
que este último es flexible, y su forma es controlada por la tensión de las 
fibras del cuerpo ciliar. Paraenfocar objetos lejanos, se aplana, para 
enfocar objetos cercanos, se ensancha. La distancia entre el centro del 
cristalino y la retina (que llamaremos distancia focal), varía de 
aproximadamente 17mm a 14mm.~\cite{joseramon2005}\\
Cuando los rayos paralelos pasan a través de una lente convexa, convergen 
hacia un punto que se denomina punto focal.\\
Realmente toda lente tiene dos puntos focales según la luz pase en un sentido o
en el opuesto. La distancia focal está también relacionada con la cantidad de luz
refractada por la lente. Es el denominado factor de potencia D cuyo valor es la inversa
de la distancia focal y su unidad de medida la dioptría.\\
Otro valor que se encontrará en toda óptica es el número F. Este parámetro
indica la relación entre la distancia focal y el diámetro del diafragma:
\begin{equation}
    F = \frac{f}{D}    
\end{equation}
\begin{center}
    \includegraphics[width=0.75\textwidth]{Capitulo2/Fig1_4.eps}       
    \captionof{figure}{Componentes generales del ojo humano}\label{Fig1_4}
\end{center}


\section{Procesamiento de datos}
Este trabajo de investigación se basa en el procesamiento de datos usando un framework
llamado ROS (del inglés Robot Operating System).
\subsection{ROS}
Un sistema de comunicación es a menudo una de las primeras necesidades que surgen al 
implementar una nueva aplicación de robot. El sistema de mensajería integrado y 
probado de ROS ahorra tiempo al administrar los detalles de la comunicación entre 
los nodos distribuidos a través del mecanismo anónimo de publicación / suscripción. 
Otro beneficio de usar un sistema de paso de mensajes es que te obliga a implementar 
interfaces claras entre los nodos en tu sistema, mejorando así la encapsulación y 
promoviendo la reutilización de código. La estructura de estas interfaces de mensajes 
se define en el mensaje IDL (Lenguaje de descripción de interfaz).\\
Decidí usar ROS porque crear un software de robot verdaderamente robusto y de uso 
general es difícil. Desde la perspectiva del robot, los problemas que parecen triviales
para los humanos a menudo varían enormemente entre instancias de tareas y entornos. 
Hacer frente a estas variaciones es tan difícil que se necesita apoyo de un sistema
de comunicación.\\
ROS tiene tres niveles de conceptos: el nivel del sistema de archivos, el nivel del gráfico 
de cómputo y el nivel de la comunidad. ~\cite{ROS}
\subsubsection{Nivel de sistemas de archivos de ROS}
Los conceptos de nivel de sistema de archivos cubren principalmente los recursos de ROS que 
encuentra en el sistema, tales como:
\begin{itemize}
    \item \textbf{Paquetes}\\
    Los paquetes son la unidad principal para organizar el software 
    en ROS. Un paquete puede contener procesos (nodos) de tiempo de ejecución de ROS, 
    una biblioteca dependiente de ROS, conjuntos de datos, archivos de configuración o 
    cualquier otra cosa que se organice conjuntamente de manera útil. Los paquetes son 
    el elemento de construcción más atómico y el elemento de lanzamiento en ROS. Lo 
    que significa que lo más granular que puede construir y lanzar es un paquete.
\end{itemize}
\subsubsection{Nivel de gráfico de cómputo ROS}
En términos generales, ROS sigue la filosofía de desarrollo de software de Unix 
en varios aspectos clave. Esto tiende a hacer que ROS se sienta "natural" para los 
desarrolladores que vienen de un entorno Unix, pero algo "críptico" al principio 
para aquellos que han usado principalmente entornos de desarrollo gráfico en 
Windows o Mac OS X.~\cite{ROSMIKE}\\
Los sistemas ROS consisten en numerosos programas pequeños informáticos que se 
conectan entre sí e intercambian mensajes continuamente. Estos mensajes viajan 
directamente de un programa a otro.\\
Los conceptos básicos del gráfico de cómputo de ROS son nodos, mastaer, 
servidor de parámetros, mensajes, servicios, topics y bags, los cuales 
proporcionan datos al gráfico de diferentes maneras siguiendo la filosofia
antes descrita.
\begin{itemize}
    \item \textbf{Nodo}\\
    los nodos son procesos que realizan cálculos. ROS está diseñado para ser modular 
    a nivel de nodo; un sistema de control de robot generalmente comprende muchos nodos.
    \item \textbf{Master}\\
    Un programa intermedio que conecta nodos.
    \begin{center}
        \includegraphics[width=0.5\textwidth]{Capitulo2/Fig2.eps}       
        \captionof{figure}{Nodos conectados al Master}\label{Fig2}
    \end{center}
    \item \textbf{Topics}\\
    Los mensajes se enrutan a través de un sistema de transporte con semántica de 
    publicación / suscripción. Un nodo envía un mensaje al publicarlo en un topic 
    determinado. El topic es un nombre que se utiliza para identificar el contenido del 
    mensaje.
    \begin{center}
        \includegraphics[width=0.75\textwidth]{Capitulo2/Fig3.eps}       
        \captionof{figure}{Representación grafica de Topics}\label{Fig3}
    \end{center}
    \item \textbf{Mensajes}\\
    Los mensajes básicamente están pasando por el topic. Hay mensajes existentes 
    basados en tipos de datos predefinidos, y los usuarios pueden escribir sus 
    propios mensajes.
    \item \textbf{Parámetros}\\
    El servidor de parámetros permite que los datos se almacenen por clave en una 
    ubicación central. Actualmente es parte del Máster.
    \item \textbf{Servicios}\\
    Ya hemos visto ROS Topics, que tiene un mecanismo de publicación y suscripción. 
    El servicio ROS tiene un mecanismo de solicitud / respuesta. Una llamada de 
    servicio es una función, que puede llamar siempre que un nodo cliente envíe una 
    solicitud. El nodo que crea una llamada de servicio se llama nodo Servidor y el 
    que llama al servicio se llama nodo cliente.~\cite{ROSLENTIN}
    \begin{center}
        \includegraphics[width=0.75\textwidth]{Capitulo2/Fig4.eps}       
        \captionof{figure}{Comunicación de mensajes}\label{Fig4}
    \end{center}
 
\end{itemize}
\subsection{Tarjeta procesadora}
Como se abordó anteriormente, ROS es el framework en el cual el proyecto esta corriendo,
dicho framework tiene ciertas especificaciones que un sistema operativo debe de cumplir
para poder ser instalado. Debido a que el sistema debe estar embebido en un prototipo
relativamente pequeño, es decir que no podrá soportar ni la carga ni las dimensiones
de un laptop, se definió conveniente la implementación de una tarjeta procesadora, y que
dentro de las múltiples opciones del mercado la ODROID fue la seleccionada.\\
Las placas de la serie Odroid son similares a Raspberry Pi, pero tiene una mejor 
configuración y rendimiento. Se basa en la arquitectura ARM.~\cite{ROSLENTIN}\\
ODROID significa Open + Android. Es una plataforma de desarrollo tanto de 
hardware como de software. 
\begin{center}
    \includegraphics[width=0.55\textwidth]{Capitulo2/Fig5.eps}       
    \captionof{figure}{Odroid XU-4}\label{Fig5}
\end{center}

El modelo XU-4 cuenta con las siguientes especificaciones:
\begin{itemize}
    \item \textbf{Procesador}\\
    Samsung Exynos5422 Cortex™-A15 2Ghz and Cortex™-A7 Octa
    core CPUs con Mali Mali-T628 MP6 GPU.\\
    Es un procesador mobil que fue lanzado en 2014 por Samsung para su celular S5.
    \item \textbf{Almacenamiento}\\
    Hay dos tipos de almacenamiento de el sistema operativo. El primero es usando
    una microSD y el segundo es utilizando un modulo eMMC.
    \item \textbf{Alimentación}\\
    Es necesario alimentar con 5V y con un minimo de 4A para su optimo funcionamiento.
    \item \textbf{Perifericos}
    \begin{itemize}
        \item USB hosts
        \item HDMI
        \item Ethernet RJ-45
        \item GPIO (Entradas y salidas de SPI,ADC e IRQ)
        \item Comunicación serial
        \item USB 3.0
    \end{itemize}
    ~\cite{hardkernel2017}
\end{itemize}
Con base en pruebas hechas por el proveedor, el modelo XU-4 resulta ser superior
a otras tarjetas de desarrollo del mercado.\\
Ejecutaron varios puntos de referencia para medir la potencia informática en el XU4. 
Las mismas pruebas se realizaron en el Raspberry Pi 3 Modelo B, ODROID-C1 +, ODROID-C2 
y ODROID-XU4.
Los valores de los resultados de la prueba se escalaron uniformemente para fines de 
comparación. Se midió que la potencia informática del XU4 era ~ 7 veces más rápida que 
la última Raspberry Pi 3 gracias a los núcleos 2Ghz Cortex-A15 y un ancho de banda de 
memoria de 64 bits mucho mayor.\\ 
Compilar código en el XU4 es súper rápido. La memoria RAM DDR3 de 2 GB de 
alto rendimiento es una ventaja adicional que permite compilar la mayoría de los 
programas directamente en el XU4.~\cite{hardkernel2020}
\begin{center}
    \includegraphics[width=0.65\textwidth]{Capitulo2/Fig6.eps}       
    \captionof{figure}{Pruebas de performance}\label{Fig6}
\end{center}

\subsection{Sistema operativo}
Una vez elegida la tarjeta de desarrollo con la cual se estará trabajando para este
proyecto, el siguiente paso es escoger el sistema operativo que dará soporte a nuestro
sistema. Por defecto ODROID nos sugiere utilizar Ubuntu en su versión MATE.
\subsubsection{Ubuntu MATE}
Ubuntu MATE es una distribución de Linux gratuita y de código abierto y un derivado
oficial de Ubuntu.\\
Ubuntu es uno, si no es que el más grande, empleador de Linux en el mundo.Linux está en el
corazón de Ubuntu y hace posible crear sistemas operativos seguros, potentes y versátiles.\\
Ubuntu MATE toma el sistema operativo basado en Ubuntu y agrega el MATE Desktop.\\
Donde podemos definir MATE Desktop como una implementación de la metáfora del Desktop 
hecha de un conjunto de programas que se ejecutan en la parte superior de un sistema 
operativo de computadora, que comparten una interfaz gráfica de usuario (GUI) común. 
Las GUI de escritorio ayudan al usuario a acceder y editar archivos fácilmente.
~\cite{ubuntu2014}\\
Ubuntu soporta arquitecturas armhf, tipo de arquitectura de la odroid, además de optimizar
el sistema operativo sin sacrificar las ventajas que provee para una Computadora Portátil.
